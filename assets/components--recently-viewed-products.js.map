{"version":3,"file":"components--recently-viewed-products.js","sources":["../theming/js/components/recently-viewed-products.js"],"sourcesContent":["/**\n *  @class\n *  @function RecentlyViewedProducts\n */\nif (!customElements.get('recently-viewed-products')) {\n  class RecentlyViewedProducts extends HTMLElement {\n    constructor() {\n      super();\n\n      this.url = theme.routes.search_url + '?view=recently-viewed&type=product&q=';\n      this.container = this.querySelector('.products');\n      this.currentId = this.dataset.productHandle;\n      this.max = 4;\n      this.products = '';\n      if (window.localStorage) {\n        let recentIds = window.localStorage.getItem('recently-viewed');\n        if (recentIds && typeof (recentIds) !== undefined) {\n          window.recentlyViewedIds = JSON.parse(recentIds);\n        }\n      }\n    }\n\n    connectedCallback() {\n      this.buildUrl();\n    }\n\n    buildUrl() {\n      let i = 0;\n      window.recentlyViewedIds.forEach((val) => {\n        // Skip current product\n        if (val === this.currentId) {\n          return;\n        }\n        // Stop at max\n        if (i >= this.max) {\n          return;\n        }\n        this.products += 'handle:' + val + ' OR ';\n        i++;\n      });\n\n      this.url = this.url + encodeURIComponent(this.products);\n\n      this.fetchProducts();\n    }\n\n    fetchProducts() {\n      fetch(this.url)\n      .then(response => response.text())\n      .then(text => {\n        const html = document.createElement('div');\n        html.innerHTML = text;\n        const recommendations = html.querySelector('.products');\n\n        if (recommendations && recommendations.innerHTML.trim().length) {\n          this.container.innerHTML = recommendations.innerHTML;\n          this.classList.add('product-recommendations--loaded');\n        }\n\n      })\n      .catch(e => {\n        console.error(e);\n      });\n    }\n  }\n\n  customElements.define('recently-viewed-products', RecentlyViewedProducts);\n}"],"names":["RecentlyViewedProducts","recentIds","i","val","response","text","html","recommendations"],"mappings":"AAIA,GAAI,CAAC,eAAe,IAAI,0BAA0B,EAAG,CACnD,MAAMA,UAA+B,WAAY,CAC/C,aAAc,CAQZ,GAPA,MAAO,EAEP,KAAK,IAAM,MAAM,OAAO,WAAa,wCACrC,KAAK,UAAY,KAAK,cAAc,WAAW,EAC/C,KAAK,UAAY,KAAK,QAAQ,cAC9B,KAAK,IAAM,EACX,KAAK,SAAW,GACZ,OAAO,aAAc,CACvB,IAAIC,EAAY,OAAO,aAAa,QAAQ,iBAAiB,EACzDA,GAAa,OAAQA,IAAe,SACtC,OAAO,kBAAoB,KAAK,MAAMA,CAAS,EAEzD,CACA,CAEI,mBAAoB,CAClB,KAAK,SAAU,CACrB,CAEI,UAAW,CACT,IAAIC,EAAI,EACR,OAAO,kBAAkB,QAASC,GAAQ,CAEpCA,IAAQ,KAAK,YAIbD,GAAK,KAAK,MAGd,KAAK,UAAY,UAAYC,EAAM,OACnCD,KACR,CAAO,EAED,KAAK,IAAM,KAAK,IAAM,mBAAmB,KAAK,QAAQ,EAEtD,KAAK,cAAe,CAC1B,CAEI,eAAgB,CACd,MAAM,KAAK,GAAG,EACb,KAAKE,GAAYA,EAAS,KAAM,CAAA,EAChC,KAAKC,GAAQ,CACZ,MAAMC,EAAO,SAAS,cAAc,KAAK,EACzCA,EAAK,UAAYD,EACjB,MAAME,EAAkBD,EAAK,cAAc,WAAW,EAElDC,GAAmBA,EAAgB,UAAU,KAAI,EAAG,SACtD,KAAK,UAAU,UAAYA,EAAgB,UAC3C,KAAK,UAAU,IAAI,iCAAiC,EAGvD,CAAA,EACA,MAAM,GAAK,CACV,QAAQ,MAAM,CAAC,CACvB,CAAO,CACP,CACA,CAEE,eAAe,OAAO,2BAA4BP,CAAsB,CAC1E"}