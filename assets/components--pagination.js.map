{"version":3,"file":"components--pagination.js","sources":["../theming/js/components/pagination.js"],"sourcesContent":["/**\n *  @class\n *  @function Pagination\n */\n\nif (!customElements.get('pagination')) {\n  class Pagination extends HTMLElement {\n    constructor() {\n      super();\n      const id = this.dataset.section;\n      this.button = this.querySelector('.load-more');\n      this.grid = document.querySelector('[data-id=' + id + ']');\n      this.animations_enabled = document.body.classList.contains('animations-true') && typeof gsap !== 'undefined';\n      this.i = 2;\n    }\n\n    connectedCallback() {\n      if (this.classList.contains('pagination-type--loadmore')) {\n        this.loadMore();\n      }\n      if (this.classList.contains('pagination-type--infinite')) {\n        this.infinite();\n      }\n\n    }\n\n    addUrlParam(search, key) {\n      var newParam = key + '=' + this.i,\n        params = '?' + newParam;\n\n      // If the \"search\" string exists, then build params from it\n      if (search) {\n        // Try to replace an existance instance\n        params = search.replace(new RegExp('([?&])' + key + '[^&]*'), '$1' + newParam);\n\n        // If nothing was replaced, then add the new param to the end\n        if (params === search) {\n          params += '&' + newParam;\n        }\n      }\n\n      return params;\n    }\n\n    loadMore() {\n      let base = this;\n      this.button.addEventListener('click', function () {\n        base.loadProducts();\n        this.blur();\n        return false;\n      });\n    }\n\n    infinite() {\n      let base = this;\n      base.observer = new IntersectionObserver(function (entries) {\n        if (entries[0].intersectionRatio === 1) {\n          base.loadProducts();\n        }\n      }, {\n        threshold: [0, 1]\n      });\n      base.observer.observe(base);\n    }\n\n    loadProducts() {\n      let base = this,\n        url = document.location.pathname + base.addUrlParam(document.location.search, 'page');\n      if (base.getAttribute('loading')) {\n        return;\n      }\n      base.i++;\n      base.setAttribute('loading', true);\n      fetch(url)\n      .then(response => response.text())\n      .then((responseText) => {\n        const html = responseText;\n        base.renderProducts(html, url);\n\n        dispatchCustomEvent('pagination:page-changed', {\n          url: url\n        });\n      });\n    }\n\n    renderProducts(html, url) {\n      let base = this,\n        grid_to_replace = new DOMParser().parseFromString(html, 'text/html').getElementById('product-grid');\n\n      if (!grid_to_replace) {\n        if (base.observer) {\n          base.observer.unobserve(base);\n        }\n        base.removeAttribute('loading');\n        if (base.button) {\n          base.button.classList.add('visually-hidden');\n        }\n        return;\n      }\n      let products = grid_to_replace.querySelectorAll('.column');\n\n      for (var i = 0; i < products.length; i++) {\n        this.grid.appendChild(products[i]);\n      }\n      if (this.animations_enabled) {\n        gsap.set(products, {\n          opacity: 0,\n          y: 30\n        });\n        gsap.to(products, {\n          duration: 0.5,\n          y: 0,\n          opacity: 1,\n          stagger: 0.05,\n          onComplete: function () {\n            base.removeAttribute('loading');\n            if (typeof StampedFn.loadBadges !== \"undefined\") {\n              StampedFn.loadBadges();\n            }\n          }\n        });\n      } else {\n        base.removeAttribute('loading');\n        if (typeof StampedFn.loadBadges !== \"undefined\") {\n          StampedFn.loadBadges();\n        }\n      }\n    }\n  }\n\n  customElements.define('pagination-theme', Pagination);\n}"],"names":["Pagination","id","search","key","newParam","params","base","entries","url","response","responseText","html","grid_to_replace","products","i"],"mappings":"AAKA,GAAI,CAAC,eAAe,IAAI,YAAY,EAAG,CACrC,MAAMA,UAAmB,WAAY,CACnC,aAAc,CACZ,MAAO,EACP,MAAMC,EAAK,KAAK,QAAQ,QACxB,KAAK,OAAS,KAAK,cAAc,YAAY,EAC7C,KAAK,KAAO,SAAS,cAAc,YAAcA,EAAK,GAAG,EACzD,KAAK,mBAAqB,SAAS,KAAK,UAAU,SAAS,iBAAiB,GAAK,OAAO,KAAS,IACjG,KAAK,EAAI,CACf,CAEI,mBAAoB,CACd,KAAK,UAAU,SAAS,2BAA2B,GACrD,KAAK,SAAU,EAEb,KAAK,UAAU,SAAS,2BAA2B,GACrD,KAAK,SAAU,CAGvB,CAEI,YAAYC,EAAQC,EAAK,CACvB,IAAIC,EAAWD,EAAM,IAAM,KAAK,EAC9BE,EAAS,IAAMD,EAGjB,OAAIF,IAEFG,EAASH,EAAO,QAAQ,IAAI,OAAO,SAAWC,EAAM,OAAO,EAAG,KAAOC,CAAQ,EAGzEC,IAAWH,IACbG,GAAU,IAAMD,IAIbC,CACb,CAEI,UAAW,CACT,IAAIC,EAAO,KACX,KAAK,OAAO,iBAAiB,QAAS,UAAY,CAChD,OAAAA,EAAK,aAAc,EACnB,KAAK,KAAM,EACJ,EACf,CAAO,CACP,CAEI,UAAW,CACT,IAAIA,EAAO,KACXA,EAAK,SAAW,IAAI,qBAAqB,SAAUC,EAAS,CACtDA,EAAQ,CAAC,EAAE,oBAAsB,GACnCD,EAAK,aAAc,CAE7B,EAAS,CACD,UAAW,CAAC,EAAG,CAAC,CACxB,CAAO,EACDA,EAAK,SAAS,QAAQA,CAAI,CAChC,CAEI,cAAe,CACb,IAAIA,EAAO,KACTE,EAAM,SAAS,SAAS,SAAWF,EAAK,YAAY,SAAS,SAAS,OAAQ,MAAM,EAClFA,EAAK,aAAa,SAAS,IAG/BA,EAAK,IACLA,EAAK,aAAa,UAAW,EAAI,EACjC,MAAME,CAAG,EACR,KAAKC,GAAYA,EAAS,KAAM,CAAA,EAChC,KAAMC,GAAiB,CACtB,MAAMC,EAAOD,EACbJ,EAAK,eAAeK,EAAMH,CAAG,EAE7B,oBAAoB,0BAA2B,CAC7C,IAAKA,CACf,CAAS,CACT,CAAO,EACP,CAEI,eAAeG,EAAMH,EAAK,CACxB,IAAIF,EAAO,KACTM,EAAkB,IAAI,UAAS,EAAG,gBAAgBD,EAAM,WAAW,EAAE,eAAe,cAAc,EAEpG,GAAI,CAACC,EAAiB,CAChBN,EAAK,UACPA,EAAK,SAAS,UAAUA,CAAI,EAE9BA,EAAK,gBAAgB,SAAS,EAC1BA,EAAK,QACPA,EAAK,OAAO,UAAU,IAAI,iBAAiB,EAE7C,MACR,CACM,IAAIO,EAAWD,EAAgB,iBAAiB,SAAS,EAEzD,QAASE,EAAI,EAAGA,EAAID,EAAS,OAAQC,IACnC,KAAK,KAAK,YAAYD,EAASC,CAAC,CAAC,EAE/B,KAAK,oBACP,KAAK,IAAID,EAAU,CACjB,QAAS,EACT,EAAG,EACb,CAAS,EACD,KAAK,GAAGA,EAAU,CAChB,SAAU,GACV,EAAG,EACH,QAAS,EACT,QAAS,IACT,WAAY,UAAY,CACtBP,EAAK,gBAAgB,SAAS,EAC1B,OAAO,UAAU,WAAe,KAClC,UAAU,WAAY,CAEpC,CACA,CAAS,IAEDA,EAAK,gBAAgB,SAAS,EAC1B,OAAO,UAAU,WAAe,KAClC,UAAU,WAAY,EAGhC,CACA,CAEE,eAAe,OAAO,mBAAoBN,CAAU,CACtD"}