{"version":3,"file":"components--predictive-search.js","sources":["../theming/js/components/predictive-search.js"],"sourcesContent":["/**\n *  @class\n *  @function BackToTop\n */\nif (!customElements.get('search-form')) {\n  class SearchForm extends HTMLElement {\n    constructor() {\n      super();\n\n    }\n\n    connectedCallback() {\n      this.is_drawer = this.dataset.drawer;\n      this.drawer = this.closest('#Search-Drawer');\n      this.form = this.querySelector('form');\n      this.button = document.querySelectorAll('.thb-quick-search');\n      this.input = this.querySelector('.search-field');\n      this.defaultTab = this.querySelector('.side-panel-content--initial');\n      this.predictiveSearchResults = this.querySelector('.thb-predictive-search');\n      this.cc = this.querySelector('.searchform--click-capture');\n\n      this.setupEventListeners();\n    }\n\n    setupEventListeners() {\n      this.form.addEventListener('submit', this.onFormSubmit.bind(this));\n\n      this.input.addEventListener('input', debounce((event) => {\n        this.onChange(event);\n      }, 300).bind(this));\n      this.input.addEventListener('focus', debounce((event) => {\n        this.onChange(event);\n      }, 300).bind(this));\n\n      this.button.forEach((item, i) => {\n        item.addEventListener('click', (event) => {\n          event.preventDefault();\n          document.body.classList.add('open-cc');\n          if (this.is_drawer) {\n            this.drawer.classList.add('active');\n          }\n          return false;\n        });\n      });\n\n      this.cc?.addEventListener('click', this.close.bind(this));\n\n      document.addEventListener('keyup', (e) => {\n        if (e.code && e.code.toUpperCase() === 'ESCAPE') {\n          this.close();\n        }\n      });\n    }\n\n    getQuery() {\n      return this.input.value.trim();\n    }\n\n    onChange() {\n      const searchTerm = this.getQuery();\n\n      if (!searchTerm.length) {\n        if (!this.is_drawer) {\n          this.close();\n        }\n        return;\n      }\n      if (!this.is_drawer) {\n        this.open();\n      }\n      this.predictiveSearchResults.classList.add('active');\n      this.getSearchResults(searchTerm);\n    }\n\n    onFormSubmit(event) {\n      if (!this.getQuery().length) {\n        event.preventDefault();\n      }\n    }\n\n    onFocus() {\n      const searchTerm = this.getQuery();\n\n      if (!searchTerm.length) {\n        this.predictiveSearchResults.innerHTML = '';\n        return;\n      }\n\n      this.getSearchResults(searchTerm);\n    }\n\n    getSearchResults(searchTerm) {\n\n      this.predictiveSearchResults.classList.add('loading');\n\n      fetch(`${theme.routes.predictive_search_url}?q=${encodeURIComponent(searchTerm)}&${encodeURIComponent('resources[type]')}=product,article,query,page&${encodeURIComponent('resources[limit]')}=10&section_id=predictive-search`)\n      .then((response) => {\n        this.predictiveSearchResults.classList.remove('loading');\n        if (!response.ok) {\n          var error = new Error(response.status);\n          throw error;\n        }\n\n        return response.text();\n      })\n      .then((text) => {\n        const resultsMarkup = new DOMParser().parseFromString(text, 'text/html').querySelector('#shopify-section-predictive-search').innerHTML;\n\n        this.renderSearchResults(resultsMarkup);\n      })\n      .catch((error) => {\n        throw error;\n      });\n    }\n\n    renderSearchResults(resultsMarkup) {\n      this.predictiveSearchResults.innerHTML = resultsMarkup;\n      if (!this.is_drawer) {\n        this.predictiveSearchResults.querySelector('#search-results-submit').classList.remove('button');\n      }\n      this.predictiveSearchResults.querySelector('#search-results-submit').addEventListener('click', () => {\n        this.form.submit();\n      });\n    }\n\n    close() {\n      console.log('close');\n      this.predictiveSearchResults.setAttribute('inert', '');\n      document.body.classList.remove('open-search');\n    }\n\n    open() {\n      document.body.classList.add('open-search');\n      this.predictiveSearchResults.removeAttribute('inert');\n    }\n  }\n\n  customElements.define('search-form', SearchForm);\n}"],"names":["SearchForm","_a","event","item","i","searchTerm","response","error","text","resultsMarkup"],"mappings":"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"}