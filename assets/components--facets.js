class f extends HTMLElement{constructor(){super(),this.init()}init(){this.drawer=document.getElementById("Facet-Drawer"),this.container=this.closest(".facets--bar-sticky"),this.addEventListener("click",e=>{e.preventDefault(),document.body.classList.toggle("open-cc"),this.drawer.classList.toggle("active")}),this.container&&this.enableSticky()}enableSticky(){let e=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--header-height"),10)+1;this.observer=new IntersectionObserver(([t])=>{t.target.classList.toggle("is-pinned",t.intersectionRatio<=1&&t.intersectionRatio>0)},{threshold:[1],rootMargin:`-${e}px 0px 0px 0px`}),this.observer.observe(this.container)}}customElements.define("facet-toggle",f);class n extends HTMLElement{constructor(){super(),this.onActiveFilterClick=this.onActiveFilterClick.bind(this),this.debouncedOnSubmit=debounce(e=>{e.target.id!=="compare_toggle"&&this.onSubmitHandler(e)},500),this.querySelector("form").addEventListener("input",this.debouncedOnSubmit.bind(this))}static setListeners(){const e=t=>{const r=t.state?t.state.searchParams:n.searchParamsInitial;r!==n.searchParamsPrev&&n.renderPage(r,null,!1)};window.addEventListener("popstate",e)}static toggleActiveFacets(e=!0){document.querySelectorAll(".js-facet-remove").forEach(t=>{t.classList.toggle("disabled",e)})}static renderPage(e,t,r=!0){n.searchParamsPrev=e;const o=n.getSections(),s=document.getElementsByClassName("thb-filter-count");document.getElementById("ProductGridContainer").querySelector(".collection").classList.add("loading");for(var i of s)i.classList.add("loading");o.forEach(l=>{const c=`${window.location.pathname}?section_id=${l.section}&${e}`,a=u=>u.url===c;n.filterData.some(a)?n.renderSectionFromCache(a,t):n.renderSectionFromFetch(c,t)}),r&&n.updateURLHash(e)}static renderSectionFromFetch(e,t){fetch(e).then(r=>r.text()).then(r=>{const o=r;n.filterData=[...n.filterData,{html:o,url:e}],n.renderFilters(o,t),n.renderProductGridContainer(o),n.renderProductCount(o),new FacetsToggle})}static renderSectionFromCache(e,t){const r=n.filterData.find(e).html;n.renderFilters(r,t),n.renderProductGridContainer(r),n.renderProductCount(r)}static renderProductGridContainer(e){document.getElementById("ProductGridContainer").innerHTML=new DOMParser().parseFromString(e,"text/html").getElementById("ProductGridContainer").innerHTML}static renderProductCount(e){const t=new DOMParser().parseFromString(e,"text/html").getElementById("ProductCount"),r=document.getElementsByClassName("thb-filter-count");if(t)for(var o of r)o.innerHTML=t.innerHTML,o.classList.remove("loading")}static renderFilters(e,t){const r=new DOMParser().parseFromString(e,"text/html"),o=r.querySelectorAll("#FacetFiltersForm collapsible-row, #FacetFiltersFormMobile collapsible-row"),s=c=>{const a=t?t.target.closest("collapsible-row"):void 0;return a?c.dataset.index===a.dataset.index:!1},i=Array.from(o).filter(c=>!s(c)),l=Array.from(o).find(s);i.forEach(c=>{document.querySelector(`collapsible-row[data-index="${c.dataset.index}"]`).innerHTML=c.innerHTML}),n.renderActiveFacets(r),n.renderAdditionalElements(r),l&&n.renderCounts(l,t.target.closest("collapsible-row"))}static renderActiveFacets(e){[".active-facets"].forEach(r=>{const o=e.querySelector(r);o&&(document.querySelector(r).innerHTML=o.innerHTML)}),n.toggleActiveFacets(!1)}static renderAdditionalElements(e){[".mobile-filter-count"].forEach(r=>{e.querySelector(r)&&(document.querySelector(r).innerHTML=e.querySelector(r).innerHTML)})}static renderCounts(e,t){const r=t.querySelector(".facets__selected");e.querySelector(".facets__selected")&&r&&(t.querySelector(".facets__selected").outerHTML=e.querySelector(".facets__selected").outerHTML)}static updateURLHash(e){history.pushState({searchParams:e},"",`${window.location.pathname}${e&&"?".concat(e)}`)}static getSections(){return[{section:document.getElementById("product-grid").dataset.id}]}onSubmitHandler(e){e.preventDefault();const t=new FormData(e.target.closest("form")),r=new URLSearchParams(t);r.get("filter.v.price.gte")==="0.00"&&r.delete("filter.v.price.gte"),document.querySelector(".price_slider")&&r.get("filter.v.price.lte")===parseFloat(document.querySelector(".price_slider").dataset.max).toFixed(2)&&r.delete("filter.v.price.lte"),n.renderPage(r.toString(),e)}onActiveFilterClick(e){e.preventDefault(),n.toggleActiveFacets();const t=e.currentTarget.href.indexOf("?")==-1?"":e.currentTarget.href.slice(e.currentTarget.href.indexOf("?")+1);n.renderPage(t)}}n.filterData=[];n.searchParamsInitial=window.location.search.slice(1);n.searchParamsPrev=window.location.search.slice(1);customElements.define("facet-filters-form",n);n.setListeners();class m extends HTMLElement{constructor(){super(),this.querySelectorAll("a").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault(),(this.closest("facet-filters-form")||document.querySelector("facet-filters-form")).onActiveFilterClick(t)})})}}customElements.define("facet-remove",m);class g extends HTMLElement{constructor(){super()}connectedCallback(){this.compareToggle=this.querySelector("#compare_toggle"),this.compareToggle&&this.compareToggle.addEventListener("change",this.onCompare)}onCompare(e){return document.body.classList.toggle("compare-true"),e.preventDefault(),!1}}customElements.define("facet-toolbar",g);class h extends HTMLElement{constructor(){super()}connectedCallback(){let e=this.querySelector(".price_slider"),t=this.querySelector(".price_slider_amount"),r={start:[parseFloat(e.dataset.minValue||0),parseFloat(e.dataset.maxValue||e.dataset.max)],connect:!0,step:10,direction:document.dir,handleAttributes:[{"aria-label":"lower"},{"aria-label":"upper"}],range:{min:0,max:parseFloat(e.dataset.max)}},o=new CustomEvent("input"),s=this.closest("facet-filters-form")||document.querySelector("facet-filters-form");e.classList.contains("noUi-target")&&e.noUiSlider.destroy(),noUiSlider.create(e,r),e.noUiSlider.on("update",function(i){t.querySelector(".field__input_min").value=i[0],t.querySelector(".field__input_max").value=i[1]}),e.noUiSlider.on("change",function(i){s.querySelector("form").dispatchEvent(o)})}}customElements.define("price-slider",h);
//# sourceMappingURL=components--facets.js.map
