{"version":3,"file":"components--scroll-shadow.js","sources":["../theming/js/components/scroll-shadow.js"],"sourcesContent":["const template = `\n  <style>\n  :host {\n    display: inline-block;\n    position: relative;\n  }\n  :host([hidden]) {\n    display: none;\n  }\n  s {\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    pointer-events: none;\n\t\tz-index: 5;\n\t\tborder-radius: var(--scroll-shadow-radius);\n    background:\n      var(--scroll-shadow-top, radial-gradient(farthest-side at 50% 0%, rgba(0,0,0,.2), rgba(0,0,0,0))) top/100% var(--top),\n      var(--scroll-shadow-bottom, radial-gradient(farthest-side at 50% 100%, rgba(0,0,0,.2), rgba(0,0,0,0))) bottom/100% var(--bottom),\n      var(--scroll-shadow-left, radial-gradient(farthest-side at 0%, rgba(0,0,0,.2), rgba(0,0,0,0))) left/var(--left) 100%,\n      var(--scroll-shadow-right, radial-gradient(farthest-side at 100%, rgba(0,0,0,.2), rgba(0,0,0,0))) right/var(--right) 100%;\n    background-repeat: no-repeat;\n  }\n  </style>\n  <slot></slot>\n  <s></s>\n`\n\nconst updaters = new WeakMap()\n\nexport class ScrollShadowElement extends HTMLElement {\n  static get observedAttributes() {\n    return ['el']\n  }\n\n  get el() {\n    return this.getAttribute('el')\n  }\n\n  set el(value) {\n    this.setAttribute('el', value)\n  }\n\n  constructor() {\n    super()\n    this.attachShadow({ mode: 'open' }).innerHTML = template\n    updaters.set(this, new Updater(this.shadowRoot.lastElementChild))\n  }\n\n  connectedCallback() {\n    this.shadowRoot.querySelector('slot').addEventListener('slotchange', () => this.start())\n    this.start()\n  }\n\n  disconnectedCallback() {\n    updaters.get(this).stop()\n  }\n\n  attributeChangedCallback(_name, oldValue, newValue) {\n    if (oldValue !== newValue) {\n      this.scrollEl = newValue ? this.querySelector(newValue) : null\n      this.start()\n    }\n  }\n\n  start() {\n    const el = this.scrollEl || this.firstElementChild\n    updaters.get(this).start(el, this.scrollEl ? this.firstElementChild : null)\n  }\n}\n\nclass Updater {\n  constructor(targetElement) {\n    const update = this.update.bind(this, targetElement, getComputedStyle(targetElement))\n\n    this.handleScroll = throttle(update)\n    this.resizeObserver = new ResizeObserver(update)\n  }\n\n  start(element, rootElement) {\n    if (this.el) this.stop()\n    if (element) {\n      element.addEventListener('scroll', this.handleScroll)\n      this.resizeObserver.observe(element)\n      this.el = element\n    }\n    if (rootElement) {\n      this.resizeObserver.observe(rootElement)\n      this.rootEl = rootElement\n    }\n  }\n\n  stop() {\n    if (!this.el) return\n    this.el.removeEventListener('scroll', this.handleScroll)\n    this.resizeObserver.disconnect()\n    this.el = null\n    this.rootEl = null\n  }\n\n  update(targetElement, computedStyle) {\n    const { el, rootEl } = this\n    if (!el) return\n\n    const maxSize = Number(computedStyle.getPropertyValue('--scroll-shadow-size') || 14)\n    const style = {\n      '--top': clamp(el.scrollTop, 0, maxSize),\n      '--bottom': clamp(el.scrollHeight - el.offsetHeight - el.scrollTop, 0, maxSize),\n      '--left': clamp(el.scrollLeft, 0, maxSize),\n      '--right': clamp(el.scrollWidth - el.offsetWidth - el.scrollLeft, 0, maxSize),\n    }\n\n    if (rootEl) {\n      const clientRect = el.getBoundingClientRect()\n      const rootClientRect = rootEl.getBoundingClientRect()\n\n      Object.assign(style, {\n        top: clamp(clientRect.top - rootClientRect.top),\n        bottom: clamp(rootClientRect.bottom - clientRect.bottom),\n        left: clamp(clientRect.left - rootClientRect.left),\n        right: clamp(rootClientRect.right - clientRect.right),\n      })\n    }\n\n    for (const key in style) {\n      targetElement.style.setProperty(key, `${style[key]}px`)\n    }\n  }\n}\n\nfunction clamp(num, min = 0, max) {\n  if (num < min) return min\n  if (num > max) return max\n  return num\n}\n\nfunction throttle(callback) {\n  let id = null\n  return () => {\n    if (id) return\n    id = requestAnimationFrame(() => {\n      callback()\n      id = null\n    })\n  }\n}\n\nif ('customElements' in window && 'ResizeObserver' in window) {\n  customElements.define('scroll-shadow', ScrollShadowElement)\n}\n"],"names":["template","updaters","ScrollShadowElement","value","Updater","_name","oldValue","newValue","el","targetElement","update","throttle","element","rootElement","computedStyle","rootEl","maxSize","style","clamp","clientRect","rootClientRect","key","num","min","max","callback","id"],"mappings":"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"}