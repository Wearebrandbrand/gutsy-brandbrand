{%- liquid
  assign popup_delay = section.settings.popup_delay
  assign disable_for_accounts = section.settings.disable_for_accounts
  assign show_on_specific_page = section.settings.show_on_specific_page
  assign specific_page = section.settings.specific_page
  assign popup_image = section.settings.popup_image
  assign popup_position = section.settings.popup_position
  assign text_alignment = section.settings.text_alignment
  assign show_popup = true

  if show_on_specific_page
    assign show_popup = false
  endif

  if show_on_specific_page and specific_page != blank and specific_page == request.path
    assign show_popup = true
  endif

  if disable_for_accounts and customer
    assign show_popup = false
  endif
-%}
{%- if show_popup -%}
{{ 'components--overlay-group.css' | asset_url | stylesheet_tag }}
<modal-dialog id="Popup-{{ section.id }}" data-section-id="{{ section.id }}" data-popup="1" class="product-popup-modal product-popup-modal--{{ popup_position }} popup-modal" data-delay="{{ popup_delay }}">
  <div role="dialog" aria-modal="true" class="product-popup-modal__content{% if show_popup %} product-popup-modal__content--has-image{% endif %}" tabindex="-1">
    {%- if popup_image -%}
    <div class="product-popup-modal__content-image">
      {% render 'responsive-image', image: popup_image %}
    </div>
    {%- endif -%}
    <button id="ModalClose-{{ section.id }}" type="button" class="product-popup-modal__toggle" aria-label="{{ 'accessibility.close' | t }}">{% render 'svg-icons' with 'close' %}</button>
    <div class="product-popup-modal__content-info text-{{ text_alignment }}">
      {%- for block in section.blocks -%}
        {%- case block.type -%}
          {%- when 'heading' -%}
            <div class="product-popup-modal--heading {{ block.settings.heading_size }}" {{ block.shopify_attributes }}>{{ block.settings.text | newline_to_br }}</div>
          {%- when 'text' -%}
            <div class="product-popup-modal--text rte description-size--{{ block.settings.description_size }}" {{ block.shopify_attributes }}>{{ block.settings.text }}</div>
          {%- when 'button' -%}
            {% if block.settings.button_text != blank %}
              <div class="product-popup-modal--button">
                <a class="button full{% if block.settings.button_outline %} outline{% endif %}" href="{{ block.settings.button_link }}" role="button" title="{{ block.settings.button_text | escape }}" {{ block.shopify_attributes }}><span>{{ block.settings.button_text }}</span></a>
              </div>
            {% endif %}
          {%- when 'countdown' -%}
            {%- liquid
              assign timer_year = block.settings.timer_year
              assign timer_month = block.settings.timer_month
              assign timer_day = block.settings.timer_day
              assign timer_hour = block.settings.timer_hour
              assign timer_minute = block.settings.timer_minute

              assign timezone = 1 | date: '%z'

              capture date
                echo timer_day | append: '-' | append: timer_month | append: '-' | append: timer_year
              endcapture

              capture time
                echo timer_hour | append: ':' | append: timer_minute
              endcapture
            -%}
            <countdown-timer class="countdown-timer" data-date="{{ date }}" data-time="{{ time }}" data-timezone="{{ timezone }}">
              <div class="countdown-timer--column days">
                <span class="countdown-timer--column--number">0</span>
                <span class="countdown-timer--column--text">{{ 'sections.countdown_banner.days' | t }}</span>
              </div>
              <div class="countdown-timer--column hours">
                <span class="countdown-timer--column--number">0</span>
                <span class="countdown-timer--column--text">{{ 'sections.countdown_banner.hours' | t }}</span>
              </div>
              <div class="countdown-timer--column minutes">
                <span class="countdown-timer--column--number">0</span>
                <span class="countdown-timer--column--text">{{ 'sections.countdown_banner.minutes' | t }}</span>
              </div>
              <div class="countdown-timer--column seconds">
                <span class="countdown-timer--column--number">0</span>
                <span class="countdown-timer--column--text">{{ 'sections.countdown_banner.seconds' | t }}</span>
              </div>
            </countdown-timer>
            <script src="{{ 'sections--countdown-banner.js' | asset_url }}" defer="defer"></script>
          {%- when 'email-signup' -%}
            <style>
              .popup-email-form {
                display: flex;
                flex-direction: row;
                gap: 8px;
                margin-top: 20px;
              }

              .popup-email-form input[type="email"] {
                flex-grow: 1;
                padding: 12px;
                border: 1px solid #ccc;
                border-radius: 6px;
                font-size: 16px;
                width: 100%;
              }

              .popup-email-form button[type="submit"] {
                background-color: #1B4D3E;
                color: white;
                border: none;
                border-radius: 6px;
                padding: 12px 20px;
                font-weight: 600;
                font-size: 16px;
                text-transform: uppercase;
                cursor: pointer;
              }

              .popup-email-form button[type="submit"]:hover {
                background-color: #174134;
              }
            </style>

            <form method="post" action="/contact#Popup-{{ section.id }}" class="popup-email-form">
              <input type="hidden" name="form_type" value="customer">
              <input type="hidden" name="utf8" value="âœ“">
              <input type="email" name="contact[email]" placeholder="Jouw e-mail" required>
              <button type="submit">Verzend</button>
            </form>
        {%- endcase -%}
      {%- endfor -%}
    </div>
  </div>
</modal-dialog>
<script src="{{ 'components--modal-dialog.js' | asset_url }}" defer="defer"></script>
{%- endif -%}
