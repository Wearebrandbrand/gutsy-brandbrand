{"version":3,"file":"components--product-compare-panel.js","sources":["../theming/js/components/product-compare-panel.js"],"sourcesContent":["/**\n *  @class\n *  @function ProductComparePanel\n */\nif (!customElements.get('product-compare-panel')) {\n  class ProductComparePanel extends HTMLElement {\n    constructor() {\n      super();\n      this.toggle = this.querySelector('.compare-toggle');\n      this.drawer = this.querySelector('.compare-drawer');\n      this.clear = this.querySelector('.compare-clear');\n      this.start = this.querySelector('.compare-start');\n      this.modal = this.querySelector('.product-compare-modal');\n      this.table = this.querySelector('product-compare-table');\n      this.max = Number(this.dataset.max);\n      this.href = '';\n    }\n\n    connectedCallback() {\n      setTimeout(() => this.toggle.classList.add('compare-toggle--active'), 250);\n      this.addEventListeners();\n      this.updateCompareCheckboxes();\n      this.updateCompareCounters();\n      this.updateStartButton();\n    }\n\n    addEventListeners() {\n      this.toggle.addEventListener('click', this.onButtonClick.bind(this));\n      this.drawer.addEventListener('click', this.onRemoveClick.bind(this));\n      this.clear.addEventListener('click', this.onClearClick.bind(this));\n      this.start.addEventListener('click', this.onStartClick.bind(this));\n      document.addEventListener('change', this.onCheckboxClick.bind(this));\n    }\n\n    getSelectedProducts() {\n      return JSON.parse(localStorage.getItem('compare-products-brandbrand')) || [];\n    }\n\n    addToCompare(productId, productUrl, productHandle) {\n      const compareProducts = this.getSelectedProducts();\n      if (!compareProducts.some(product => product.id === productId)) {\n        compareProducts.push({id: productId, url: productUrl, handle: productHandle});\n        localStorage.setItem('compare-products-brandbrand', JSON.stringify(compareProducts));\n        this.updateCompareComponents();\n      }\n    }\n\n    removeFromCompare(productId) {\n      const compareProducts = this.getSelectedProducts().filter(product => product.id !== productId);\n      localStorage.setItem('compare-products-brandbrand', JSON.stringify(compareProducts));\n      this.updateCompareComponents();\n    }\n\n    updateStartButton() {\n      this.start.disabled = !this.getCompareCount();\n    }\n\n    onCheckboxClick(event) {\n      if (event.target.classList.contains('product-card-compare--checkbox')) {\n        const {productId, productUrl, productHandle} = event.target.dataset;\n        if (event.target.checked) {\n          if (this.getCompareCount() < this.max) {\n            this.addToCompare(productId, productUrl, productHandle);\n          }\n        } else {\n          this.removeFromCompare(productId);\n        }\n      }\n    }\n\n    updateCompareCheckboxes() {\n      const compareProducts = this.getSelectedProducts();\n      const compareCount = this.getCompareCount();\n      document.querySelectorAll('.product-card-compare--checkbox').forEach(checkbox => {\n        const isChecked = compareProducts.some(product => product.id === checkbox.dataset.productId);\n        checkbox.checked = isChecked;\n        checkbox.disabled = !isChecked && compareCount >= this.max;\n      });\n    }\n\n    onRemoveClick(event) {\n      if (event.target.classList.contains('compare-remove')) {\n        const productId = event.target.dataset.productId;\n        this.removeFromCompare(productId);\n        event.target.closest('product-card-small').remove();\n      }\n    }\n\n    onClearClick() {\n      const compareProducts = this.getSelectedProducts();\n      compareProducts.forEach(product => this.removeFromCompare(product.id));\n      this.drawer.querySelector('.compare-drawer--list').innerHTML = '<div class=\"compare-drawer--list-item\"></div>'.repeat(this.max);\n      this.closeDrawer();\n    }\n\n    onStartClick() {\n      this.modal.show();\n      this.table.dispatchEvent(new CustomEvent('render-product-compare-modal', {bubbles: true}));\n    }\n\n    openDrawer() {\n      this.drawer.removeAttribute('inert');\n      this.drawer.focus();\n      this.drawer.classList.add('active');\n      document.body.classList.add('open-cc');\n    }\n\n    closeDrawer() {\n      this.drawer.setAttribute('inert', '');\n      this.drawer.blur();\n      this.drawer.classList.remove('active');\n      document.body.classList.remove('open-cc');\n    }\n\n    onButtonClick() {\n      this.renderProducts();\n      this.openDrawer();\n    }\n\n    getCompareCount() {\n      return this.getSelectedProducts().length;\n    }\n\n    updateCompareCounters() {\n      const count = this.getCompareCount();\n      document.querySelectorAll('.compare-counter').forEach(counter => {\n        counter.textContent = count;\n      });\n    }\n\n    async renderProducts() {\n      const compareProducts = this.getSelectedProducts();\n      const returnArray = await Promise.all(compareProducts.map(async (product) => {\n        const response = await fetch(`${product.url}?sections=product-compare-card`);\n        const data = await response.json();\n        return this.getSectionInnerHTML(data['product-compare-card'], '.shopify-section');\n      }));\n\n      const returnHtml = returnArray.join('') + '<div class=\"compare-drawer--list-item\"></div>'.repeat(this.max - compareProducts.length);\n      this.drawer.querySelector('.compare-drawer--list').innerHTML = returnHtml;\n    }\n\n    getSectionInnerHTML(html, selector) {\n      return new DOMParser()\n      .parseFromString(html, 'text/html')\n      .querySelector(selector).innerHTML;\n    }\n\n    updateCompareComponents() {\n      this.updateCompareCheckboxes();\n      this.updateCompareCounters();\n      this.updateStartButton();\n    }\n  }\n\n  customElements.define('product-compare-panel', ProductComparePanel);\n}\n"],"names":["ProductComparePanel","productId","productUrl","productHandle","compareProducts","product","event","compareCount","checkbox","isChecked","count","counter","returnHtml","data","html","selector"],"mappings":"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"}