{"version":3,"file":"components--recipient-form.js","sources":["../theming/js/components/recipient-form.js"],"sourcesContent":["if (!customElements.get('recipient-form')) {\n  customElements.define('recipient-form', class RecipientForm extends HTMLElement {\n    constructor() {\n      super();\n      this.checkboxInput = this.querySelector(`#Recipient-Checkbox-${this.dataset.sectionId}`);\n      this.checkboxInput.disabled = false;\n      this.hiddenControlField = this.querySelector(`#Recipient-Control-${this.dataset.sectionId}`);\n      this.hiddenControlField.disabled = true;\n      this.emailInput = this.querySelector(`#Recipient-email-${this.dataset.sectionId}`);\n      this.nameInput = this.querySelector(`#Recipient-name-${this.dataset.sectionId}`);\n      this.messageInput = this.querySelector(`#Recipient-message-${this.dataset.sectionId}`);\n      this.errorMessageWrapper = this.querySelector('.product-form__recipient-error-message-wrapper');\n      this.errorMessageList = this.errorMessageWrapper?.querySelector('ul');\n      this.errorMessage = this.errorMessageWrapper?.querySelector('.error-message');\n      this.defaultErrorHeader = this.errorMessage?.innerText;\n      this.currentProductVariantId = this.dataset.productVariantId;\n      this.addEventListener('change', this.onChange.bind(this));\n    }\n\n    connectedCallback() {\n      document.addEventListener(\"cart:item-added\", this.onCartAdded.bind(this));\n      document.addEventListener(\"product:variant-change\", this.onVariantChange.bind(this));\n      document.addEventListener(\"product:variant-error\", this.onVariantError.bind(this));\n    }\n\n    onCartAdded(event) {\n      if (event.detail.product.id.toString() === this.currentProductVariantId) {\n        this.resetRecipientForm();\n      }\n    }\n\n    onVariantChange(event) {\n      if (event.detail.sectionId === this.dataset.sectionId) {\n        this.currentProductVariantId = event.detail.variant.id.toString();\n      }\n    }\n\n    onVariantError(event) {\n      if (event.detail.source === 'product-form' && event.detail.productVariantId.toString() === this.currentProductVariantId) {\n        this.displayErrorMessage(event.detail.message, event.detail.errors);\n      }\n    }\n\n    onChange() {\n      if (!this.checkboxInput.checked) {\n        this.clearInputFields();\n        this.clearErrorMessage();\n      }\n    }\n\n    clearInputFields() {\n      this.emailInput.value = '';\n      this.nameInput.value = '';\n      this.messageInput.value = '';\n    }\n\n    displayErrorMessage(title, body) {\n      this.clearErrorMessage();\n      this.errorMessageWrapper.hidden = false;\n      if (typeof body === 'object') {\n        this.errorMessage.innerText = this.defaultErrorHeader;\n        return Object.entries(body).forEach(([key, value]) => {\n          const errorMessageId = `RecipientForm-${key}-error-${this.dataset.sectionId}`;\n          const fieldSelector = `#Recipient-${key}-${this.dataset.sectionId}`;\n          const placeholderElement = this.querySelector(`${fieldSelector}`);\n          const label = placeholderElement?.getAttribute('placeholder') || key;\n          const message = `${label} ${value}`;\n          const errorMessageElement = this.querySelector(`#${errorMessageId}`);\n          const errorTextElement = errorMessageElement?.querySelector('.error-message');\n          if (!errorTextElement) return;\n\n          if (this.errorMessageList) {\n            this.errorMessageList.appendChild(this.createErrorListItem(fieldSelector, message));\n          }\n\n          errorTextElement.innerText = `${message}.`;\n          errorMessageElement.classList.remove('hidden');\n\n          const inputElement = this[`${key}Input`];\n          if (!inputElement) return;\n\n          inputElement.setAttribute('aria-invalid', true);\n          inputElement.setAttribute('aria-describedby', errorMessageId);\n        });\n      }\n\n      this.errorMessage.innerText = body;\n    }\n\n    createErrorListItem(target, message) {\n      const li = document.createElement('li');\n      const a = document.createElement('a');\n      a.setAttribute('href', target);\n      a.innerText = message;\n      li.appendChild(a);\n      li.className = \"error-message\";\n      return li;\n    }\n\n    clearErrorMessage() {\n      this.errorMessageWrapper.hidden = true;\n\n      if (this.errorMessageList) this.errorMessageList.innerHTML = '';\n\n      this.querySelectorAll('.recipient-fields .form__message').forEach(field => {\n        field.classList.add('hidden');\n        const textField = field.querySelector('.error-message');\n        if (textField) textField.innerText = '';\n      });\n\n      [this.emailInput, this.messageInput, this.nameInput].forEach(inputElement => {\n        inputElement.setAttribute('aria-invalid', false);\n        inputElement.removeAttribute('aria-describedby');\n      });\n    }\n\n    resetRecipientForm() {\n      if (this.checkboxInput.checked) {\n        this.checkboxInput.checked = false;\n        this.clearInputFields();\n        this.clearErrorMessage();\n      }\n    }\n  });\n}"],"names":["_a","_b","_c","event","title","body","key","value","errorMessageId","fieldSelector","placeholderElement","message","errorMessageElement","errorTextElement","inputElement","target","li","a","field","textField"],"mappings":"AAAK,eAAe,IAAI,gBAAgB,GACtC,eAAe,OAAO,iBAAkB,cAA4B,WAAY,CAC9E,aAAc,CAFlB,IAAAA,EAAAC,EAAAC,EAGM,MAAO,EACP,KAAK,cAAgB,KAAK,cAAc,uBAAuB,KAAK,QAAQ,SAAS,EAAE,EACvF,KAAK,cAAc,SAAW,GAC9B,KAAK,mBAAqB,KAAK,cAAc,sBAAsB,KAAK,QAAQ,SAAS,EAAE,EAC3F,KAAK,mBAAmB,SAAW,GACnC,KAAK,WAAa,KAAK,cAAc,oBAAoB,KAAK,QAAQ,SAAS,EAAE,EACjF,KAAK,UAAY,KAAK,cAAc,mBAAmB,KAAK,QAAQ,SAAS,EAAE,EAC/E,KAAK,aAAe,KAAK,cAAc,sBAAsB,KAAK,QAAQ,SAAS,EAAE,EACrF,KAAK,oBAAsB,KAAK,cAAc,gDAAgD,EAC9F,KAAK,kBAAmBF,EAAA,KAAK,sBAAL,YAAAA,EAA0B,cAAc,MAChE,KAAK,cAAeC,EAAA,KAAK,sBAAL,YAAAA,EAA0B,cAAc,kBAC5D,KAAK,oBAAqBC,EAAA,KAAK,eAAL,YAAAA,EAAmB,UAC7C,KAAK,wBAA0B,KAAK,QAAQ,iBAC5C,KAAK,iBAAiB,SAAU,KAAK,SAAS,KAAK,IAAI,CAAC,CAC9D,CAEI,mBAAoB,CAClB,SAAS,iBAAiB,kBAAmB,KAAK,YAAY,KAAK,IAAI,CAAC,EACxE,SAAS,iBAAiB,yBAA0B,KAAK,gBAAgB,KAAK,IAAI,CAAC,EACnF,SAAS,iBAAiB,wBAAyB,KAAK,eAAe,KAAK,IAAI,CAAC,CACvF,CAEI,YAAYC,EAAO,CACbA,EAAM,OAAO,QAAQ,GAAG,SAAU,IAAK,KAAK,yBAC9C,KAAK,mBAAoB,CAEjC,CAEI,gBAAgBA,EAAO,CACjBA,EAAM,OAAO,YAAc,KAAK,QAAQ,YAC1C,KAAK,wBAA0BA,EAAM,OAAO,QAAQ,GAAG,SAAU,EAEzE,CAEI,eAAeA,EAAO,CAChBA,EAAM,OAAO,SAAW,gBAAkBA,EAAM,OAAO,iBAAiB,aAAe,KAAK,yBAC9F,KAAK,oBAAoBA,EAAM,OAAO,QAASA,EAAM,OAAO,MAAM,CAE1E,CAEI,UAAW,CACJ,KAAK,cAAc,UACtB,KAAK,iBAAkB,EACvB,KAAK,kBAAmB,EAEhC,CAEI,kBAAmB,CACjB,KAAK,WAAW,MAAQ,GACxB,KAAK,UAAU,MAAQ,GACvB,KAAK,aAAa,MAAQ,EAChC,CAEI,oBAAoBC,EAAOC,EAAM,CAG/B,GAFA,KAAK,kBAAmB,EACxB,KAAK,oBAAoB,OAAS,GAC9B,OAAOA,GAAS,SAClB,YAAK,aAAa,UAAY,KAAK,mBAC5B,OAAO,QAAQA,CAAI,EAAE,QAAQ,CAAC,CAACC,EAAKC,CAAK,IAAM,CACpD,MAAMC,EAAiB,iBAAiBF,CAAG,UAAU,KAAK,QAAQ,SAAS,GACrEG,EAAgB,cAAcH,CAAG,IAAI,KAAK,QAAQ,SAAS,GAC3DI,EAAqB,KAAK,cAAc,GAAGD,CAAa,EAAE,EAE1DE,EAAU,IADFD,GAAA,YAAAA,EAAoB,aAAa,iBAAkBJ,CACzC,IAAIC,CAAK,GAC3BK,EAAsB,KAAK,cAAc,IAAIJ,CAAc,EAAE,EAC7DK,EAAmBD,GAAA,YAAAA,EAAqB,cAAc,kBAC5D,GAAI,CAACC,EAAkB,OAEnB,KAAK,kBACP,KAAK,iBAAiB,YAAY,KAAK,oBAAoBJ,EAAeE,CAAO,CAAC,EAGpFE,EAAiB,UAAY,GAAGF,CAAO,IACvCC,EAAoB,UAAU,OAAO,QAAQ,EAE7C,MAAME,EAAe,KAAK,GAAGR,CAAG,OAAO,EAClCQ,IAELA,EAAa,aAAa,eAAgB,EAAI,EAC9CA,EAAa,aAAa,mBAAoBN,CAAc,EACtE,CAAS,EAGH,KAAK,aAAa,UAAYH,CACpC,CAEI,oBAAoBU,EAAQJ,EAAS,CACnC,MAAMK,EAAK,SAAS,cAAc,IAAI,EAChCC,EAAI,SAAS,cAAc,GAAG,EACpC,OAAAA,EAAE,aAAa,OAAQF,CAAM,EAC7BE,EAAE,UAAYN,EACdK,EAAG,YAAYC,CAAC,EAChBD,EAAG,UAAY,gBACRA,CACb,CAEI,mBAAoB,CAClB,KAAK,oBAAoB,OAAS,GAE9B,KAAK,mBAAkB,KAAK,iBAAiB,UAAY,IAE7D,KAAK,iBAAiB,kCAAkC,EAAE,QAAQE,GAAS,CACzEA,EAAM,UAAU,IAAI,QAAQ,EAC5B,MAAMC,EAAYD,EAAM,cAAc,gBAAgB,EAClDC,IAAWA,EAAU,UAAY,GAC7C,CAAO,EAED,CAAC,KAAK,WAAY,KAAK,aAAc,KAAK,SAAS,EAAE,QAAQL,GAAgB,CAC3EA,EAAa,aAAa,eAAgB,EAAK,EAC/CA,EAAa,gBAAgB,kBAAkB,CACvD,CAAO,CACP,CAEI,oBAAqB,CACf,KAAK,cAAc,UACrB,KAAK,cAAc,QAAU,GAC7B,KAAK,iBAAkB,EACvB,KAAK,kBAAmB,EAEhC,CACA,CAAG"}