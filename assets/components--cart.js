class i{constructor(){this.container=document.getElementById("Cart"),this.setupEventListeners()}onChange(e){e.target.type=="number"?(this.updateQuantity(e.target.dataset.index,e.target.value),console.log("changed the data")):e.target.getAttribute("id")=="CartSpecialInstructions"&&this.saveNotes()}saveNotes(){fetch(`${theme.routes.cart_update_url}.js`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({note:document.getElementById("CartSpecialInstructions").value})})}setupEventListeners(){this.removeProductEvent(),this.debouncedOnChange=debounce(e=>{this.onChange(e)},300),document.addEventListener("cart:refresh",e=>{this.refresh()}),this.container.addEventListener("change",this.debouncedOnChange.bind(this)),this.termsCheckbox()}getSectionsToRender(){return[{id:"Cart",section:"main-cart",selector:".thb-cart-form"},{id:"cart-drawer-toggle",section:"cart-bubble",selector:".thb-item-count"}]}displayErrors(e,t){const r=document.getElementById(`Line-item-error-${e}`)||document.getElementById(`CartDrawer-LineItemError-${e}`);r&&(r.removeAttribute("hidden"),r.querySelector(".cart-item__error-text").innerHTML=t,this.container.querySelector(`#CartItem-${e}`).classList.remove("loading"))}getSectionInnerHTML(e,t){return new DOMParser().parseFromString(e,"text/html").querySelector(t).innerHTML}updateQuantity(e,t){this.container.classList.add("cart-disabled"),e&&this.container.querySelector(`#CartItem-${e}`).classList.add("loading");const r=JSON.stringify({line:e,quantity:t,sections:this.getSectionsToRender().map(n=>n.section),sections_url:window.location.pathname});dispatchCustomEvent("line-item:change:start",{quantity:t}),fetch(`${theme.routes.cart_change_url}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:r}).then(n=>n.text()).then(n=>{const s=JSON.parse(n);if(s.errors){this.displayErrors(e,s.errors),this.container.classList.remove("cart-disabled");return}this.renderContents(s,e,!1),this.container.classList.remove("cart-disabled"),dispatchCustomEvent("line-item:change:end",{quantity:t,cart:s})})}refresh(){this.container.classList.add("cart-disabled"),fetch(`${window.location.pathname}?sections=main-cart`).then(t=>t.text()).then(t=>{const r=JSON.parse(t);if(r.errors){this.displayErrors(line,r.errors),this.container.classList.remove("cart-disabled");return}this.renderContents(r,!1,!0),this.container.classList.remove("cart-disabled")})}termsCheckbox(){let e=this.container.querySelector("#CartTerms"),t=this.container.querySelector(".button.checkout-button");e&&t&&(e.setCustomValidity(theme.strings.requiresTerms),t.addEventListener("click",function(r){e.checked||(e.reportValidity(),e.focus(),r.preventDefault())}))}removeProductEvent(){this.container.querySelectorAll(".remove").forEach(t=>{t.addEventListener("click",r=>{this.updateQuantity(r.target.dataset.index,"0"),r.preventDefault()})})}renderContents(e,t,r){this.getSectionsToRender().forEach(n=>{const s=document.getElementById(n.id).querySelector(n.selector)||document.getElementById(n.id);r?e[n.section]&&(s.innerHTML=this.getSectionInnerHTML(e[n.section],n.selector)):s.innerHTML=this.getSectionInnerHTML(e.sections[n.section],n.selector),this.removeProductEvent(),t&&this.container.querySelector(`#CartItem-${t}`)&&this.container.querySelector(`#CartItem-${t}`).classList.remove("loading"),this.termsCheckbox()})}}window.addEventListener("load",()=>{typeof i<"u"&&new i});
//# sourceMappingURL=components--cart.js.map
